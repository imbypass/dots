#!/bin/bash

killall yin

# save the wallpaper to the global wallpaper file
if [[ $1 == *.mp4 ]]; then
    ffmpeg -i $1 -ss 00:00:01.000 -vframes 1 $HOME/.local/share/wallpapers/tmp.png
    mv $HOME/.local/share/wallpapers/tmp.png $HOME/.local/share/wallpapers/.wallpaper
else
	cp $1 $HOME/.local/share/wallpapers/.wallpaper
fi

# create visible versions with extensions for other tools
cp $HOME/.local/share/wallpapers/.wallpaper $HOME/.local/share/wallpapers/wallpaper.png
cp $HOME/.local/share/wallpapers/.wallpaper $HOME/.local/share/wallpapers/wallpaper.jpg
ln -nsf "$HOME/.local/share/wallpapers/.wallpaper" "$HOME/.config/omarchy/current/background"

# set wallpaper
awww img "$HOME/.local/share/wallpapers/wallpaper.png" \
    -t random \
    --transition-fps 120 \
    --transition-duration 1 \
    --transition-step 45 \
   > /dev/null 2>&1



# rendering alert (if mp4)
if [[ $1 == *.mp4 ]]; then
    echo "Rendering video wallpaper..."
    killall yin > /dev/null 2>&1
    yin & disown > /dev/null 2>&1
    yinctl --img $1
fi
